{"version":3,"sources":["../src/requestactions.js"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","Templates","ModalDataRequest","DataPrivacyEvents","SelectedCourses","ACTIONS","APPROVE_REQUEST","DENY_REQUEST","VIEW_REQUEST","MARK_COMPLETE","CHANGE_BULK_ACTION","CONFIRM_BULK_ACTION","SELECT_ALL","APPROVE_REQUEST_SELECT_COURSE","BULK_ACTIONS","APPROVE","DENY","SELECTORS","SELECT_REQUEST","RequestActions","registerEvents","prototype","click","e","preventDefault","requestId","data","contextId","promises","call","methodname","args","when","then","result","addNotification","message","warnings","type","body","render","templateContext","approvedeny","canmarkcomplete","allowfiltering","create","title","typename","TYPE","large","modal","getRoot","on","approve","showConfirmation","approveEventWsData","deny","denyEventWsData","complete","handleSave","hidden","destroy","approveSelectCourses","showSelectedCoursesModal","show","catch","exception","completeEventWsData","requestIds","actionEvent","wsdata","bulkActionKeys","key","component","bulkaction","parseInt","val","get_strings","done","langStrings","alert","fail","each","push","length","bulkApprove","bulkApproveEventWsData","bulkDeny","bulkDenyEventWsData","change","selectAll","is","prop","action","keys","modalTitle","confirmMessage","types","SAVE_CANCEL","setSaveButtonText","save","wsfunction","wsparams","params","window","location","reload"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Request actions.\n *\n * @module     tool_dataprivacy/requestactions\n * @package    tool_dataprivacy\n * @copyright  2018 Jun Pataleta\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'tool_dataprivacy/data_request_modal',\n    'tool_dataprivacy/events',\n    'tool_dataprivacy/selectedcourses'],\nfunction($, Ajax, Notification, Str, ModalFactory, ModalEvents, Templates, ModalDataRequest, DataPrivacyEvents, SelectedCourses) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{APPROVE_REQUEST: string}}\n     * @type {{DENY_REQUEST: string}}\n     * @type {{VIEW_REQUEST: string}}\n     * @type {{MARK_COMPLETE: string}}\n     * @type {{CHANGE_BULK_ACTION: string}}\n     * @type {{CONFIRM_BULK_ACTION: string}}\n     * @type {{SELECT_ALL: string}}\n     */\n    var ACTIONS = {\n        APPROVE_REQUEST: '[data-action=\"approve\"]',\n        DENY_REQUEST: '[data-action=\"deny\"]',\n        VIEW_REQUEST: '[data-action=\"view\"]',\n        MARK_COMPLETE: '[data-action=\"complete\"]',\n        CHANGE_BULK_ACTION: '[id=\"bulk-action\"]',\n        CONFIRM_BULK_ACTION: '[id=\"confirm-bulk-action\"]',\n        SELECT_ALL: '[data-action=\"selectall\"]',\n        APPROVE_REQUEST_SELECT_COURSE: '[data-action=\"approve-selected-courses\"]',\n    };\n\n    /**\n     * List of available bulk actions.\n     *\n     * @type {{APPROVE: number}}\n     * @type {{DENY: number}}\n     */\n    var BULK_ACTIONS = {\n        APPROVE: 1,\n        DENY: 2\n    };\n\n    /**\n     * List of selectors.\n     *\n     * @type {{SELECT_REQUEST: string}}\n     */\n    var SELECTORS = {\n        SELECT_REQUEST: '.selectrequests'\n    };\n\n    /**\n     * RequestActions class.\n     */\n    var RequestActions = function() {\n        this.registerEvents();\n    };\n\n    /**\n     * Register event listeners.\n     */\n    RequestActions.prototype.registerEvents = function() {\n        $(ACTIONS.VIEW_REQUEST).click(function(e) {\n            e.preventDefault();\n\n            var requestId = $(this).data('requestid');\n            var contextId = $(this).data('contextid');\n\n            // Cancel the request.\n            var params = {\n                'requestid': requestId\n            };\n\n            var request = {\n                methodname: 'tool_dataprivacy_get_data_request',\n                args: params\n            };\n\n            var promises = Ajax.call([request]);\n            $.when(promises[0]).then(function(data) {\n                if (data.result) {\n                    return data.result;\n                }\n                // Fail.\n                Notification.addNotification({\n                    message: data.warnings[0].message,\n                    type: 'error'\n                });\n                return false;\n\n            }).then(function(data) {\n                var body = Templates.render('tool_dataprivacy/request_details', data);\n                var templateContext = {\n                    approvedeny: data.approvedeny,\n                    canmarkcomplete: data.canmarkcomplete,\n                    allowfiltering: data.allowfiltering\n                };\n                return ModalFactory.create({\n                    title: data.typename,\n                    body: body,\n                    type: ModalDataRequest.TYPE,\n                    large: true,\n                    templateContext: templateContext\n                });\n\n            }).then(function(modal) {\n                // Handle approve event.\n                modal.getRoot().on(DataPrivacyEvents.approve, function() {\n                    showConfirmation(DataPrivacyEvents.approve, approveEventWsData(requestId));\n                });\n\n                // Handle deny event.\n                modal.getRoot().on(DataPrivacyEvents.deny, function() {\n                    showConfirmation(DataPrivacyEvents.deny, denyEventWsData(requestId));\n                });\n\n                // Handle send event.\n                modal.getRoot().on(DataPrivacyEvents.complete, function() {\n                    var params = {\n                        'requestid': requestId\n                    };\n                    handleSave('tool_dataprivacy_mark_complete', params);\n                });\n\n                // Handle hidden event.\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    // Destroy when hidden.\n                    modal.destroy();\n                });\n\n                modal.getRoot().on(DataPrivacyEvents.approveSelectCourses, function() {\n                    SelectedCourses.showSelectedCoursesModal(contextId, requestId);\n                });\n\n                // Show the modal!\n                modal.show();\n\n                return;\n\n            }).catch(Notification.exception);\n        });\n\n        $(ACTIONS.APPROVE_REQUEST_SELECT_COURSE).click(function(e) {\n            e.preventDefault();\n\n            var requestId = $(this).data('requestid');\n            var contextId = $(this).data('contextid');\n\n            SelectedCourses.showSelectedCoursesModal(contextId, requestId);\n        });\n\n        $(ACTIONS.APPROVE_REQUEST).click(function(e) {\n            e.preventDefault();\n\n            var requestId = $(this).data('requestid');\n            showConfirmation(DataPrivacyEvents.approve, approveEventWsData(requestId));\n        });\n\n        $(ACTIONS.DENY_REQUEST).click(function(e) {\n            e.preventDefault();\n\n            var requestId = $(this).data('requestid');\n            showConfirmation(DataPrivacyEvents.deny, denyEventWsData(requestId));\n        });\n\n        $(ACTIONS.MARK_COMPLETE).click(function(e) {\n            e.preventDefault();\n\n            var requestId = $(this).data('requestid');\n            showConfirmation(DataPrivacyEvents.complete, completeEventWsData(requestId));\n        });\n\n        $(ACTIONS.CONFIRM_BULK_ACTION).click(function() {\n            var requestIds = [];\n            var actionEvent = '';\n            var wsdata = {};\n            var bulkActionKeys = [\n                {\n                    key: 'selectbulkaction',\n                    component: 'tool_dataprivacy'\n                },\n                {\n                    key: 'selectdatarequests',\n                    component: 'tool_dataprivacy'\n                },\n                {\n                    key: 'ok'\n                }\n            ];\n\n            var bulkaction = parseInt($('#bulk-action').val());\n\n            if (bulkaction != BULK_ACTIONS.APPROVE && bulkaction != BULK_ACTIONS.DENY) {\n                Str.get_strings(bulkActionKeys).done(function(langStrings) {\n                    Notification.alert('', langStrings[0], langStrings[2]);\n                }).fail(Notification.exception);\n\n                return;\n            }\n\n            $(\".selectrequests:checked\").each(function() {\n                requestIds.push($(this).val());\n            });\n\n            if (requestIds.length < 1) {\n                Str.get_strings(bulkActionKeys).done(function(langStrings) {\n                    Notification.alert('', langStrings[1], langStrings[2]);\n                }).fail(Notification.exception);\n\n                return;\n            }\n\n            switch (bulkaction) {\n                case BULK_ACTIONS.APPROVE:\n                    actionEvent = DataPrivacyEvents.bulkApprove;\n                    wsdata = bulkApproveEventWsData(requestIds);\n                    break;\n                case BULK_ACTIONS.DENY:\n                    actionEvent = DataPrivacyEvents.bulkDeny;\n                    wsdata = bulkDenyEventWsData(requestIds);\n            }\n\n            showConfirmation(actionEvent, wsdata);\n        });\n\n        $(ACTIONS.SELECT_ALL).change(function(e) {\n            e.preventDefault();\n\n            var selectAll = $(this).is(':checked');\n            $(SELECTORS.SELECT_REQUEST).prop('checked', selectAll);\n        });\n    };\n\n    /**\n     * Return the webservice data for the approve request action.\n     *\n     * @param {Number} requestId The ID of the request.\n     * @return {Object}\n     */\n    function approveEventWsData(requestId) {\n        return {\n            'wsfunction': 'tool_dataprivacy_approve_data_request',\n            'wsparams': {'requestid': requestId}\n        };\n    }\n\n    /**\n     * Return the webservice data for the bulk approve request action.\n     *\n     * @param {Array} requestIds The array of request ID's.\n     * @return {Object}\n     */\n    function bulkApproveEventWsData(requestIds) {\n        return {\n            'wsfunction': 'tool_dataprivacy_bulk_approve_data_requests',\n            'wsparams': {'requestids': requestIds}\n        };\n    }\n\n    /**\n     * Return the webservice data for the deny request action.\n     *\n     * @param {Number} requestId The ID of the request.\n     * @return {Object}\n     */\n    function denyEventWsData(requestId) {\n        return {\n            'wsfunction': 'tool_dataprivacy_deny_data_request',\n            'wsparams': {'requestid': requestId}\n        };\n    }\n\n    /**\n     * Return the webservice data for the bulk deny request action.\n     *\n     * @param {Array} requestIds The array of request ID's.\n     * @return {Object}\n     */\n    function bulkDenyEventWsData(requestIds) {\n        return {\n            'wsfunction': 'tool_dataprivacy_bulk_deny_data_requests',\n            'wsparams': {'requestids': requestIds}\n        };\n    }\n\n    /**\n     * Return the webservice data for the complete request action.\n     *\n     * @param {Number} requestId The ID of the request.\n     * @return {Object}\n     */\n    function completeEventWsData(requestId) {\n        return {\n            'wsfunction': 'tool_dataprivacy_mark_complete',\n            'wsparams': {'requestid': requestId}\n        };\n    }\n\n    /**\n     * Show the confirmation dialogue.\n     *\n     * @param {String} action The action name.\n     * @param {Object} wsdata Object containing ws data.\n     */\n    function showConfirmation(action, wsdata) {\n        var keys = [];\n\n        switch (action) {\n            case DataPrivacyEvents.approve:\n                keys = [\n                    {\n                        key: 'approverequest',\n                        component: 'tool_dataprivacy'\n                    },\n                    {\n                        key: 'confirmapproval',\n                        component: 'tool_dataprivacy'\n                    }\n                ];\n                break;\n            case DataPrivacyEvents.bulkApprove:\n                keys = [\n                    {\n                        key: 'bulkapproverequests',\n                        component: 'tool_dataprivacy'\n                    },\n                    {\n                        key: 'confirmbulkapproval',\n                        component: 'tool_dataprivacy'\n                    }\n                ];\n                break;\n            case DataPrivacyEvents.deny:\n                keys = [\n                    {\n                        key: 'denyrequest',\n                        component: 'tool_dataprivacy'\n                    },\n                    {\n                        key: 'confirmdenial',\n                        component: 'tool_dataprivacy'\n                    }\n                ];\n                break;\n            case DataPrivacyEvents.bulkDeny:\n                keys = [\n                    {\n                        key: 'bulkdenyrequests',\n                        component: 'tool_dataprivacy'\n                    },\n                    {\n                        key: 'confirmbulkdenial',\n                        component: 'tool_dataprivacy'\n                    }\n                ];\n                break;\n            case DataPrivacyEvents.complete:\n                keys = [\n                    {\n                        key: 'markcomplete',\n                        component: 'tool_dataprivacy'\n                    },\n                    {\n                        key: 'confirmcompletion',\n                        component: 'tool_dataprivacy'\n                    }\n                ];\n                break;\n        }\n\n        var modalTitle = '';\n        Str.get_strings(keys).then(function(langStrings) {\n            modalTitle = langStrings[0];\n            var confirmMessage = langStrings[1];\n            return ModalFactory.create({\n                title: modalTitle,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            });\n        }).then(function(modal) {\n            modal.setSaveButtonText(modalTitle);\n\n            // Handle save event.\n            modal.getRoot().on(ModalEvents.save, function() {\n                handleSave(wsdata.wsfunction, wsdata.wsparams);\n            });\n\n            // Handle hidden event.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                // Destroy when hidden.\n                modal.destroy();\n            });\n\n            modal.show();\n\n            return;\n\n        }).catch(Notification.exception);\n    }\n\n    /**\n     * Calls a web service function and reloads the page on success and shows a notification.\n     * Displays an error notification, otherwise.\n     *\n     * @param {String} wsfunction The web service function to call.\n     * @param {Object} params The parameters for the web service functoon.\n     */\n    function handleSave(wsfunction, params) {\n        // Confirm the request.\n        var request = {\n            methodname: wsfunction,\n            args: params\n        };\n\n        Ajax.call([request])[0].done(function(data) {\n            if (data.result) {\n                // On success, reload the page so that the data request table will be updated.\n                // TODO: Probably in the future, better to reload the table or the target data request via AJAX.\n                window.location.reload();\n            } else {\n                // Add the notification.\n                Notification.addNotification({\n                    message: data.warnings[0].message,\n                    type: 'error'\n                });\n            }\n        }).fail(Notification.exception);\n    }\n\n    return RequestActions;\n});\n"],"file":"requestactions.min.js"}